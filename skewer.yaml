title: Skupper Hello World
subtitle: A minimal HTTP application deployed across Kubernetes clusters using Skupper
# overview: |
#   This example is a very simple multi-service HTTP application
#   deployed across Kubernetes clusters using Skupper.

#   It contains two services:

#   * A backend service that exposes an `/api/hello` endpoint.  It
#     returns greetings of the form `Hi, <your-name>.  I am <my-name>
#     (<pod-name>)`.

#   * A frontend service that sends greetings to the backend and
#     fetches new greetings in response.

#   With Skupper, you can place the backend in one cluster and the
#   frontend in another and maintain connectivity between the two
#   services without exposing the backend to the public internet.
sites:
  west:
    title: West
    platform: kubernetes
    namespace: west
    env:
      KUBECONFIG: ~/.kube/config-west
  east:
    title: East
    platform: kubernetes
    namespace: east
    env:
      KUBECONFIG: ~/.kube/config-east
steps:
  - standard: general/install_the_skupper_command_line_tool
  - standard: kubernetes/set_up_your_namespaces
  - standard: hello_world/deploy_the_frontend_and_backend
  - title: Enable policy enforcement
    commands:
      west:
        - run: kubectl apply -f https://raw.githubusercontent.com/skupperproject/skupper/main/api/types/crds/skupper_cluster_policy_crd.yaml
      east:
        - run: kubectl apply -f https://raw.githubusercontent.com/skupperproject/skupper/main/api/types/crds/skupper_cluster_policy_crd.yaml
  - standard: kubernetes/create_your_sites
  - title: Attempt to link your sites without permission
    commands:
      west:
        - run: skupper token create ~/secret.token
          apply: readme
          output: "Error: Failed to create token: Policy validation error: incoming links are not allowed"
        - run: "skupper token create ~/secret.token || :"
          apply: test
  - title: Attempt to expose the backend without permission
    commands:
      east:
        - run: skupper expose deployment/backend --port 8080
          apply: readme
          output: "Error: Policy validation error: deployment/backend cannot be exposed"
        - run: "skupper expose deployment/backend --port 8080 || :"
          apply: test
  - title: Grant permission to link your sites and expose the backend
    preamble: |
      ~~~ yaml
      apiVersion: skupper.io/v1alpha1
      kind: SkupperClusterPolicy
      metadata:
        name: west
      spec:
        namespaces: [west]
        allowIncomingLinks: true
        allowedServices: [backend]
      ~~~

      ~~~ yaml
      apiVersion: skupper.io/v1alpha1
      kind: SkupperClusterPolicy
      metadata:
        name: east
      spec:
        namespaces: [east]
        allowedOutgoingLinksHostnames: ["*"]
        allowedExposedResources: [deployment/backend]
        allowedServices: [backend]
      ~~~
    commands:
      west:
        - run: kubectl apply -f west/policy.yaml
        - await_resource: SkupperClusterPolicy/west
      east:
        - run: kubectl apply -f east/policy.yaml
        - await_resource: SkupperClusterPolicy/east
  - standard: kubernetes/link_your_sites
  - standard: hello_world/expose_the_backend
  - standard: hello_world/access_the_frontend
  - standard: hello_world/cleaning_up
